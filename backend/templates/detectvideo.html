<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Real Vision - Video Detection</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-dark: #0e183a;
      --nav-bg: #191919;
      --primary-accent: #57f4d4;
      --input-border: #57f4d4;
      --text-muted: #7a7a9b;
      --button-shadow-color: #57f4d4aa;
    }

    body {
      background-color: var(--bg-dark);
      font-family: 'Inter', sans-serif;
    }

    nav {
      background-color: var(--nav-bg);
    }

    .brand,
    .btn-detect {
      color: var(--primary-accent);
      font-weight: 600;
      font-size: 1.125rem;
    }

    .btn-detect {
      background-color: transparent;
      border: none;
      padding: 0.375rem 0.875rem;
      border-radius: 0.25rem;
      box-shadow: 0 0.25rem 0.5rem var(--button-shadow-color);
      cursor: pointer;
    }

    .btn-detect:hover,
    .btn-detect:focus {
      background-color: var(--primary-accent);
      color: #0e183a;
    }

    .logout {
      color: white;
      font-weight: 500;
      cursor: pointer;
      font-size: 0.875rem;
    }

    .card {
      background-color: rgba(24, 35, 68, 0.65);
      border-radius: 0.5rem;
      border: 1px solid rgba(87, 244, 212, 0.4);
      padding: 2rem 2.5rem;
      max-width: 420px;
      margin: auto;
    }

    input[type="file"] {
      color: transparent;
      width: 100%;
      height: 3.25rem;
      border-radius: 0.375rem;
      border: 2px dashed var(--input-border);
      padding-top: 0.75rem;
      text-align: center;
      font-weight: 500;
    }

    input[type="file"]::before {
      content: 'Choose Video';
      color: var(--primary-accent);
      font-weight: 600;
    }

    .btn-analyze {
      background-color: var(--primary-accent);
      font-weight: 700;
      font-size: 1.125rem;
      color: var(--bg-dark);
      padding: 0.75rem 1.5rem;
      margin-top: 1.5rem;
      border-radius: 0.375rem;
      cursor: pointer;
      border: none;
    }

    h1 {
      color: var(--primary-accent);
      font-weight: 700;
      font-size: 2.25rem;
      text-align: center;
      margin-bottom: 0.5rem;
    }

    p.description {
      color: var(--text-muted);
      text-align: center;
      font-size: 1rem;
      margin-bottom: 2rem;
    }
  </style>
</head>

<body>
  <!-- NAVBAR -->
  <nav>
    <div class="flex justify-between items-center px-6 py-3 max-w-6xl mx-auto">
      <a href="/" class="brand">Real Vision</a>
      <div class="flex items-center space-x-6">
        <a href="/detect-image" class="btn-detect">Image Detect</a>
        {% if current_user.is_authenticated %}
          <a href="/logout" class="logout">Logout</a>
        {% else %}
          <a href="/login" class="logout">Login</a>
        {% endif %}
      </div>
    </div>
  </nav>

  <main class="mt-20">
    <h1>Detect DeepFake Videos</h1>
    <p class="description">Upload your video for AI-powered analysis to detect potential manipulation.</p>

    <section class="card">
      <form>
        <input type="file" accept=".mp4, .avi, .mov" />
        <button type="submit" class="btn-analyze">Analyze Video</button>
      </form>

      <p class="text-sm text-center mt-6 text-muted">
        Supported formats: <strong>MP4, AVI, MOV</strong> (Max size: 100MB)
      </p>

      <!-- RESULT CARD -->
      <div id="resultCard" class="card mt-10 opacity-0 pointer-events-none transition-all duration-300">
        <h2 style="color:var(--primary-accent);text-align:center;margin-bottom:1rem;">Analysis Result</h2>
        <div style="display:grid;gap:0.75rem;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));">
          <p><span style="color:var(--primary-accent)">Label:</span> <span class="text-white" id="rLabel"></span></p>
          <p><span style="color:var(--primary-accent)">Confidence:</span> <span class="text-white" id="rConf"></span></p>
          <p><span style="color:var(--primary-accent)">Frames:</span> <span class="text-white" id="rFrames"></span></p>
          <p><span style="color:var(--primary-accent)">Time:</span> <span class="text-white" id="rTime">s</span></p>
        </div>
        <canvas id="pieChart" style="margin-top:1.5rem;"></canvas>
      </div>
    </section>

    <p class="text-lg font-semibold mx-auto mt-8 text-center text-mint">Sample of Analyzed Frames</p>
    <div id="frameSamples" class="mt-6 flex flex-wrap gap-4 justify-center"></div>
  </main>

  <!-- FOOTER -->
  <footer class="bg-[#0b0b0b] text-gray-300 mt-20">
    <div class="container mx-auto px-6 py-12 grid gap-10 md:grid-cols-3">
      <div>
        <h3 class="text-mint text-lg font-semibold mb-4">About RealVision</h3>
        <p class="text-sm leading-relaxed">
          RealVision is a research‑driven platform to detect DeepFakes in real time and promote digital truth.
        </p>
      </div>
      <div class="space-y-2">
        <h3 class="text-mint text-lg font-semibold mb-4">Quick Links</h3>
        <ul class="text-sm space-y-1">
          <li><a href="/#features" class="hover:text-white">Features</a></li>
          <li><a href="/detect-video" class="hover:text-white">Detect Video</a></li>
          <li><a href="/detect-image" class="hover:text-white">Detect Image</a></li>
          <li><a href="/register" class="hover:text-white">Register</a></li>
          <li><a href="/about" class="hover:text-white">Contact</a></li>
        </ul>
      </div>
      <div>
        <h3 class="text-mint text-lg font-semibold mb-4">Contact Us</h3>
        <p class="text-sm">Shreesha Hegde</p>
        <p class="text-sm">BMS College of Engineering</p>
        <p class="text-sm">shreesha.mca23@bmsce.ac.in</p>
        <p class="text-sm">+91&nbsp;90710&nbsp;23691</p>
      </div>
    </div>
    <div class="border-t border-white/10">
      <div class="container mx-auto px-6 py-4 flex justify-between text-xs text-gray-400">
        <p>© 2025 RealVision. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- JS SCRIPT -->
  <script>
    const btn = document.querySelector('.btn-analyze');
    const fileI = document.querySelector('input[type=file]');
    const card = document.getElementById('resultCard');
    const lbl = document.getElementById('rLabel');
    const conf = document.getElementById('rConf');
    const fr = document.getElementById('rFrames');
    const tm = document.getElementById('rTime');
    let chart;

    btn.addEventListener('click', async e => {
      e.preventDefault();
      const f = fileI.files[0];
      if (!f) return alert('Choose a video first');

      btn.disabled = true;
      btn.textContent = 'Processing…';

      const fd = new FormData();
      fd.append('media', f);

      try {
        const res = await fetch('/api/detect-video', { method: 'POST', body: fd });
        const js = await res.json();
        if (js.error) throw js.error;

        document.getElementById("frameSamples").innerHTML = "";
        js.sample_frames.forEach(src => {
          const img = document.createElement("img");
          img.src = src;
          img.alt = "Sample frame";
          img.className = "rounded-lg border-2 border-cyan-400 shadow-lg hover:scale-105 transition-transform duration-300";
          img.style.width = "160px";
          document.getElementById("frameSamples").appendChild(img);
        });

        lbl.textContent = js.label;
        conf.textContent = (js.confidence * 100).toFixed(1) + '%';
        fr.textContent = js.frames_analyzed;
        tm.textContent = js.processing_time.toFixed(2);

        const vals = js.label === 'Fake' ? [js.confidence, 1 - js.confidence] : [1 - js.confidence, js.confidence];
        if (chart) chart.destroy();
        chart = new Chart(document.getElementById('pieChart'), {
          type: 'doughnut',
          data: {
            labels: ['Fake', 'Real'],
            datasets: [{ data: vals, backgroundColor: ['#ff4f4f', '#57f4d4'] }]
          },
          options: { plugins: { legend: { labels: { color: '#ffffff' } } } }
        });

        card.style.opacity = 1;
        card.style.pointerEvents = 'auto';
      } catch (err) {
        alert('Server error: ' + err);
      } finally {
        btn.textContent = 'Analyze Video';
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
